---
title: "2. Data structure & cleaning"
author: "G Hyun Koo"
---

## Learning goals

By the end of this tutorial, you will be able to:

- Understand vectors, data types, and data frames in R
- Convert between different data types
- Use the **tidyverse** to clean and summarize data
- Apply pipe operators to write readable R code

---

# 1.Data types in R

### 1.1 Vectors

```{r vectors}
# Vector of strings
weather <- c("windy", "cloudy", "snowy", "cold", "hot")
weather

length(weather)
weather[1]           # first element
weather[c(1, 4)]     # first and fourth elements
sort(weather)        # alphabetical order

weather[1] <- "breezy"
class(weather)

# Numeric vector
numbers <- c(7, 1, 3, 5)
sort(numbers)

# Sequence
number_seq <- 1:5
number_seq

# Logical vector
veracity <- c(TRUE, FALSE, TRUE, FALSE)
veracity
```

### 1.2 Object
```{r}
first_computer <- 1946
first_moon <- 1969
```

### 1.3 Data frames
```{r}
weather_df <- data.frame(
  day = c("Mon", "Tue", "Wed"),
  temp = c(70, 75, 80),
  snow = c(TRUE, FALSE, TRUE)
)

weather_df
```


### 1.4 Data type conversion
```{r}
x <- 5
as.character(x)  # convert to character
as.numeric(x)    # convert to numeric
as.integer(x)    # convert to integer
as.logical(x)    # convert to logical

temps <- c("30", "25", "40")
class(temps)

# Convert to numeric
temps_num <- as.numeric(temps)
class(temps_num)
```


##2. Introduction to tidyverse and the mtcars dataset

In this part of the module, we will now use mtcars, a built-in dataset from Motor Trend magazine (1974), to learn basic data cleaning and preprocessing.

::: {.callout-note}
When working with large datasets, filtering variables of interest, summarizing data, arranging, and mutating (such as to create new columns after averaging the scores) can significantly save time and memory usage in your software. We will use the 'tidyverse' package to do so. Tidyverse will automatically load packages that youâ€™re likely to use in everyday data analyses, such as dplyr, readr, tidyr ... etc.
:::

---

# 2. Data cleaning and summarizing
### 2.1 Take a first look at the data
Use head() function to check the first few rows of the dataset, View() to open the dataset

```{r install library, read data}
# install.packages("tidyverse") # Run once if needed
library(tidyverse)
data(mtcars) # Load a sample dataset
?mtcars # To learn more about the dataset
head(mtcars) # Check the first few rows
#View(mtcars) # Opens the dataset
```


### 2.2 Pipe operators: `|>`, `%>%`

::: {.callout-tip} 
In R version 4.1 and later, the base pipe operator |> works the same way as %>%.
The difference is that |> is built directly into R, so you do not need to install or load dplyr to use it.

You can turn |> on through Tools > Global Options.
:::


```{r Tip: Using pipe operators}
# Basic code (without pipe operator) 
mean(c(1, 2, 3, 4)) # mean(): we get the mean score. 
```

::: {.callout-note} 
Bonus: If we do not use c(), R will treat the numbers as separate function inputs instead of data values. Try: mean(1, 2, 3, 4) and check its result
:::

```{r}
mean(1, 2, 3, 4)
```
#### Using |> (basic pipe) 
It takes the result of one command and passes it into the next command.
```{r}
c(1, 2, 3, 4) |> mean()
```


#### Using %>% 
```{r}
library(tidyverse)
c(1, 2, 3, 4) %>% mean()
# It works almost the same way as |> 
# but requires installing and loading packages.
```

Pipe operators are useful for longer code because they reduce repetition, improve readability, simplify debugging and modification, and avoid creating temporary variables (more examples below).



### 2.3 Data cleaning 
We will use the select(), filter(), mutate(), arrange(), and summarize() functions.
You are also encouraged to use pipe operators.

#### Example 1: Select specific columns (Useful when you have a huge dataset).

Three options (with/without pipe operators):

```{r Use tidyverse for data cleaning}
  # 1) Without pipe operator
select(mtcars, mpg, hp, wt) # Select three columns from the mtcars dataset
colnames(mtcars) # You can get the column names by ?mtcars
# if you want to the first few rows of specific columns:
head(select(mtcars, mpg, hp, wt)) 

  # 2) With base pipe |>
mtcars |>
  select(mpg, hp, wt) |>
  head()

  # 3) With %>%
mtcars %>%
  select(mpg, hp, wt) %>% # Select three columns 
  head() # View the first few rows
```


#### Example 2: Filter rows where Miles/gallon (mpg) is greater than 30

```{r}
mtcars |> 
  filter(mpg > 30)
# You can also create a new filtered dataframe 'new_mtcars'
new_mtcars <- mtcars |> 
  filter(mpg > 30)
head(new_mtcars)
```

#### Example 3: Mutate (Create a new column) that shows TRUE if mpg is over 30, or FALSE otherwise

```{r}
mtcars |>
  mutate(mpg_over_30 = ifelse(mpg > 30, TRUE, FALSE))
```

#### Example 4: Arrange data by horsepower (hp) in descending order

```{r}
mtcars |> 
  arrange(desc(hp))
```

#### Example 5: Summarize data to get the average (mean) mpg and hp

```{r}
mtcars |>
  summarize(
    avg_mpg = mean(mpg),
    avg_hp = mean(hp)
    )
```



# 3. Practice: Working with HDSinRdata

::: {.callout-note}
In this practice question, I will demonstrate how to clean and work with datasets from the HDSinRdata package. HDSinRdata package includes ten datasets used in the chapters and exercises of Paul, Alice (2023) "Health Data Science in R" https://alicepaul.github.io/health-data-science-using-r/.

After we call the HDSinRdata package, we will use 'covidcases' and 'mobility' data from the package. 
:::


```{r install package, load library, read data}
#install.packages("HDSinRdata")
library(HDSinRdata) 
?HDSinRdata
data(covidcases) 
?covidcases
print(covidcases) # Showcase the full dataset
data(mobility)
?mobility
print(mobility)

head(mobility) #Displays the first few lines of the dataset.
#Allows you to specify the number of lines to view; here, it shows '5'
head(mobility, n = 5) 
#Displays median, mean, min/max ... etc
summary(mobility) 
```

### Pre-processing the data (select and summarize)

```{r Understanding and pre-processing the data: use tidyverse - select and summarize}
# Check the names of the columns
colnames(covidcases)
colnames(mobility)

# Display the frequency of unique values in the 'state' column
table(covidcases$state)
table(mobility$state)

```

Filter rows where the 'state' column is 'Hawaii' You could directly filter it or create a new dataframe with the filtered rows (recommended)

```{r}
# Directly filter
covidcases |> 
  filter(state == "Hawaii")

## Create a new dataframe
hawaii_covidcases <- covidcases |>
  filter(state == "Hawaii")
print(hawaii_covidcases)

hawaii_mobility <- mobility |>
  filter(state == "Hawaii")
print(hawaii_mobility)
```

You can also use nrow() to count how many rows there are (in filtered dataset)

```{r}
nrow(hawaii_covidcases)  
nrow(hawaii_mobility)
```

---

## Summary: 

You learned how to

- Work with vectors, data frames, and objects

- Convert between data types

- Use pipe operators for readable code

- Clean and summarize real-world datasets

Next, we will build on these skills to explore data visualization and interpretation.